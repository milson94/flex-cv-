<!-- templates/form.html -->
{% extends "base.html" %}

{% block head_extra_styles %}
<style>
    .field-group {
        border: 1px solid #e2e8f0;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        background-color: #f8fafc;
    }
    
    .field-group.removable {
        position: relative;
        border-left: 4px solid #3b82f6;
    }
    
    .remove-field-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: #ef4444;
        color: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .remove-field-btn:hover {
        background: #dc2626;
    }
    
    .add-field-btn {
        background: #10b981;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        cursor: pointer;
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }
    
    .add-field-btn:hover {
        background: #059669;
    }
    
    .prefilled-field {
        background-color: #f1f5f9;
        color: #64748b;
    }
    
    .field-visibility-toggle {
        margin-left: 0.5rem;
        font-size: 0.875rem;
    }
    
    .hidden-field {
        opacity: 0.5;
        background-color: #f8f9fa;
    }
    
    .dynamic-section {
        border: 2px dashed #cbd5e1;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        background-color: #f8fafc;
    }
    
    .section-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .proficiency-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-lg">
    <h1 class="text-3xl font-bold text-center text-sky-700 mb-6">{{ title }}</h1>
    <p class="text-center text-slate-600 mb-8">Fill out your resume information below. Fields marked with * are required.</p>

    <form method="POST" action="{{ url_for('resume_form') }}" class="space-y-8">
        
        <!-- Personal Information Section -->
        <fieldset class="field-group">
            <legend class="text-lg font-semibold text-sky-700 mb-4">Personal Information</legend>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Full Name -->
                <div>
                    <label for="full_name" class="block text-sm font-medium text-slate-700">Full Name *</label>
                    <input type="text" id="full_name" name="full_name" 
                           value="{{ data.full_name or '' }}" 
                           class="form-input-base" required>
                </div>

                <!-- ID Number (new field) -->
                <div>
                    <label for="id_number" class="block text-sm font-medium text-slate-700">
                        ID Number
                        <input type="checkbox" class="field-visibility-toggle" checked onchange="toggleFieldVisibility(this, 'id_number')">
                        <span class="text-xs text-slate-500">Show/Hide</span>
                    </label>
                    <input type="text" id="id_number" name="id_number" 
                           value="{{ data.id_number or '123-45-6789' }}" 
                           class="form-input-base prefilled-field"
                           placeholder="Enter your ID number">
                </div>

                <!-- Title/Subtitle -->
                <div class="md:col-span-2">
                    <label for="title_subtitle" class="block text-sm font-medium text-slate-700">Professional Title</label>
                    <input type="text" id="title_subtitle" name="title_subtitle" 
                           value="{{ data.title_subtitle or '' }}" 
                           class="form-input-base"
                           placeholder="e.g., Senior Software Engineer | Full Stack Developer">
                </div>

                <!-- Email -->
                <div>
                    <label for="email" class="block text-sm font-medium text-slate-700">Email *</label>
                    <input type="email" id="email" name="email" 
                           value="{{ data.email or '' }}" 
                           class="form-input-base" required>
                </div>

                <!-- Phone -->
                <div>
                    <label for="phone" class="block text-sm font-medium text-slate-700">
                        Phone
                        <input type="checkbox" class="field-visibility-toggle" checked onchange="toggleFieldVisibility(this, 'phone')">
                        <span class="text-xs text-slate-500">Show/Hide</span>
                    </label>
                    <input type="tel" id="phone" name="phone" 
                           value="{{ data.phone or '' }}" 
                           class="form-input-base">
                </div>

                <!-- LinkedIn -->
                <div>
                    <label for="linkedin" class="block text-sm font-medium text-slate-700">
                        LinkedIn
                        <input type="checkbox" class="field-visibility-toggle" checked onchange="toggleFieldVisibility(this, 'linkedin')">
                        <span class="text-xs text-slate-500">Show/Hide</span>
                    </label>
                    <input type="url" id="linkedin" name="linkedin" 
                           value="{{ data.linkedin or '' }}" 
                           class="form-input-base">
                </div>

                <!-- Location -->
                <div>
                    <label for="location" class="block text-sm font-medium text-slate-700">
                        Location
                        <input type="checkbox" class="field-visibility-toggle" checked onchange="toggleFieldVisibility(this, 'location')">
                        <span class="text-xs text-slate-500">Show/Hide</span>
                    </label>
                    <input type="text" id="location" name="location" 
                           value="{{ data.location or '' }}" 
                           class="form-input-base">
                </div>

                <!-- Additional Personal Fields -->
                <div>
                    <label for="nationality" class="block text-sm font-medium text-slate-700">
                        Nationality
                        <input type="checkbox" class="field-visibility-toggle" onchange="toggleFieldVisibility(this, 'nationality')">
                        <span class="text-xs text-slate-500">Show/Hide</span>
                    </label>
                    <input type="text" id="nationality" name="nationality" 
                           value="{{ data.nationality or '' }}" 
                           class="form-input-base hidden-field">
                </div>

                <div>
                    <label for="birth_date" class="block text-sm font-medium text-slate-700">
                        Birth Date
                        <input type="checkbox" class="field-visibility-toggle" onchange="toggleFieldVisibility(this, 'birth_date')">
                        <span class="text-xs text-slate-500">Show/Hide</span>
                    </label>
                    <input type="date" id="birth_date" name="birth_date" 
                           value="{{ data.birth_date or '' }}" 
                           class="form-input-base hidden-field">
                </div>

                <div>
                    <label for="website" class="block text-sm font-medium text-slate-700">
                        Website
                        <input type="checkbox" class="field-visibility-toggle" onchange="toggleFieldVisibility(this, 'website')">
                        <span class="text-xs text-slate-500">Show/Hide</span>
                    </label>
                    <input type="url" id="website" name="website" 
                           value="{{ data.website or '' }}" 
                           class="form-input-base hidden-field">
                </div>

                <div>
                    <label for="address" class="block text-sm font-medium text-slate-700">
                        Address
                        <input type="checkbox" class="field-visibility-toggle" onchange="toggleFieldVisibility(this, 'address')">
                        <span class="text-xs text-slate-500">Show/Hide</span>
                    </label>
                    <input type="text" id="address" name="address" 
                           value="{{ data.address or '' }}" 
                           class="form-input-base hidden-field">
                </div>
            </div>
        </fieldset>

        <!-- Professional Summary -->
        <fieldset class="field-group">
            <legend class="text-lg font-semibold text-sky-700 mb-4">
                Professional Summary
                <input type="checkbox" class="field-visibility-toggle" checked onchange="toggleSectionVisibility(this, 'summary-section')">
                <span class="text-xs text-slate-500">Show/Hide Section</span>
            </legend>
            <div id="summary-section">
                <label for="summary" class="block text-sm font-medium text-slate-700">Summary</label>
                <textarea id="summary" name="summary" rows="4" 
                          class="form-textarea-base"
                          placeholder="Write a brief professional summary...">{{ data.summary or '' }}</textarea>
            </div>
        </fieldset>

        <!-- Experience Section -->
        <fieldset class="field-group">
            <legend class="text-lg font-semibold text-sky-700 mb-4">
                Professional Experience
                <input type="checkbox" class="field-visibility-toggle" checked onchange="toggleSectionVisibility(this, 'experience-section')">
                <span class="text-xs text-slate-500">Show/Hide Section</span>
            </legend>
            <div id="experience-section">
                <div id="experience-container">
                    {% for exp in data.experiences %}
                    <div class="field-group removable experience-item" data-index="{{ loop.index0 }}">
                        <button type="button" class="remove-field-btn" onclick="removeExperience(this)">×</button>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Job Title *</label>
                                <input type="text" name="exp_title[{{ loop.index0 }}]" 
                                       value="{{ exp.title or '' }}" 
                                       class="form-input-base" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Company *</label>
                                <input type="text" name="exp_company[{{ loop.index0 }}]" 
                                       value="{{ exp.company or '' }}" 
                                       class="form-input-base" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Location</label>
                                <input type="text" name="exp_location[{{ loop.index0 }}]" 
                                       value="{{ exp.location or '' }}" 
                                       class="form-input-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Start Date</label>
                                <input type="month" name="exp_start_date[{{ loop.index0 }}]" 
                                       value="{{ exp.start_date or '' }}" 
                                       class="form-input-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700">End Date</label>
                                <input type="month" name="exp_end_date[{{ loop.index0 }}]" 
                                       value="{{ exp.end_date or '' }}" 
                                       class="form-input-base"
                                       {% if exp.is_present %}disabled{% endif %}>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" name="exp_present[{{ loop.index0 }}]" 
                                       {% if exp.is_present %}checked{% endif %}
                                       class="form-checkbox-base"
                                       onchange="toggleEndDate(this)">
                                <label class="ml-2 text-sm text-slate-700">Currently working here</label>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-slate-700">Description</label>
                                <textarea name="exp_description[{{ loop.index0 }}]" rows="3" 
                                          class="form-textarea-base"
                                          placeholder="Describe your responsibilities and achievements...">{{ exp.description or '' }}</textarea>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <button type="button" class="add-field-btn" onclick="addExperience()">+ Add Experience</button>
            </div>
        </fieldset>

        <!-- Education Section -->
        <fieldset class="field-group">
            <legend class="text-lg font-semibold text-sky-700 mb-4">
                Education
                <input type="checkbox" class="field-visibility-toggle" checked onchange="toggleSectionVisibility(this, 'education-section')">
                <span class="text-xs text-slate-500">Show/Hide Section</span>
            </legend>
            <div id="education-section">
                <div id="education-container">
                    {% for edu in data.education_entries %}
                    <div class="field-group removable education-item" data-index="{{ loop.index0 }}">
                        <button type="button" class="remove-field-btn" onclick="removeEducation(this)">×</button>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Degree *</label>
                                <input type="text" name="edu_degree[{{ loop.index0 }}]" 
                                       value="{{ edu.degree or '' }}" 
                                       class="form-input-base" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Institution *</label>
                                <input type="text" name="edu_institution[{{ loop.index0 }}]" 
                                       value="{{ edu.institution or '' }}" 
                                       class="form-input-base" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Location</label>
                                <input type="text" name="edu_location[{{ loop.index0 }}]" 
                                       value="{{ edu.edu_location or '' }}" 
                                       class="form-input-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Start Date</label>
                                <input type="month" name="edu_start_date[{{ loop.index0 }}]" 
                                       value="{{ edu.start_date or '' }}" 
                                       class="form-input-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700">End Date</label>
                                <input type="month" name="edu_end_date[{{ loop.index0 }}]" 
                                       value="{{ edu.end_date or '' }}" 
                                       class="form-input-base"
                                       {% if edu.is_present %}disabled{% endif %}>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" name="edu_present[{{ loop.index0 }}]" 
                                       {% if edu.is_present %}checked{% endif %}
                                       class="form-checkbox-base"
                                       onchange="toggleEndDate(this)">
                                <label class="ml-2 text-sm text-slate-700">Currently studying</label>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-slate-700">Details</label>
                                <textarea name="edu_details[{{ loop.index0 }}]" rows="2" 
                                          class="form-textarea-base"
                                          placeholder="Additional details about your education...">{{ edu.edu_details or '' }}</textarea>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <button type="button" class="add-field-btn" onclick="addEducation()">+ Add Education</button>
            </div>
        </fieldset>

        <!-- Key Achievements Section -->
        <fieldset class="field-group">
            <legend class="text-lg font-semibold text-sky-700 mb-4">
                Key Achievements
                <input type="checkbox" class="field-visibility-toggle" checked onchange="toggleSectionVisibility(this, 'achievements-section')">
                <span class="text-xs text-slate-500">Show/Hide Section</span>
            </legend>
            <div id="achievements-section">
                <div id="achievements-container">
                    {% for ach in data.key_achievements %}
                    <div class="field-group removable achievement-item" data-index="{{ loop.index0 }}">
                        <button type="button" class="remove-field-btn" onclick="removeAchievement(this)">×</button>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Achievement Title *</label>
                                <input type="text" name="ach_title_{{ loop.index0 }}" 
                                       value="{{ ach.title or '' }}" 
                                       class="form-input-base" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Description</label>
                                <textarea name="ach_description_{{ loop.index0 }}" rows="2" 
                                          class="form-textarea-base"
                                          placeholder="Describe your achievement...">{{ ach.description or '' }}</textarea>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <button type="button" class="add-field-btn" onclick="addAchievement()">+ Add Achievement</button>
            </div>
        </fieldset>

        <!-- Languages Section -->
        <fieldset class="field-group">
            <legend class="text-lg font-semibold text-sky-700 mb-4">
                Languages
                <input type="checkbox" class="field-visibility-toggle" checked onchange="toggleSectionVisibility(this, 'languages-section')">
                <span class="text-xs text-slate-500">Show/Hide Section</span>
            </legend>
            <div id="languages-section">
                <div id="languages-container">
                    {% for lang in data.languages %}
                    <div class="field-group removable language-item" data-index="{{ loop.index0 }}">
                        <button type="button" class="remove-field-btn" onclick="removeLanguage(this)">×</button>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Language *</label>
                                <input type="text" name="lang_name[{{ loop.index0 }}]" 
                                       value="{{ lang.name or '' }}" 
                                       class="form-input-base" required
                                       placeholder="e.g., English, Spanish, French">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700">Overall Level</label>
                                <select name="lang_level[{{ loop.index0 }}]" class="form-input-base">
                                    <option value="">Select level</option>
                                    <option value="Beginner" {% if lang.level == 'Beginner' %}selected{% endif %}>Beginner</option>
                                    <option value="Elementary" {% if lang.level == 'Elementary' %}selected{% endif %}>Elementary</option>
                                    <option value="Intermediate" {% if lang.level == 'Intermediate' %}selected{% endif %}>Intermediate</option>
                                    <option value="Upper Intermediate" {% if lang.level == 'Upper Intermediate' %}selected{% endif %}>Upper Intermediate</option>
                                    <option value="Advanced" {% if lang.level == 'Advanced' %}selected{% endif %}>Advanced</option>
                                    <option value="Native" {% if lang.level == 'Native' %}selected{% endif %}>Native</option>
                                </select>
                            </div>
                            <div class="proficiency-grid">
                                <div>
                                    <label class="block text-xs font-medium text-slate-700">Reading</label>
                                    <select name="lang_reading[{{ loop.index0 }}]" class="form-input-base text-sm">
                                        <option value="">Select</option>
                                        <option value="Basic" {% if lang.reading == 'Basic' %}selected{% endif %}>Basic</option>
                                        <option value="Good" {% if lang.reading == 'Good' %}selected{% endif %}>Good</option>
                                        <option value="Excellent" {% if lang.reading == 'Excellent' %}selected{% endif %}>Excellent</option>
                                        <option value="Native" {% if lang.reading == 'Native' %}selected{% endif %}>Native</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-700">Writing</label>
                                    <select name="lang_writing[{{ loop.index0 }}]" class="form-input-base text-sm">
                                        <option value="">Select</option>
                                        <option value="Basic" {% if lang.writing == 'Basic' %}selected{% endif %}>Basic</option>
                                        <option value="Good" {% if lang.writing == 'Good' %}selected{% endif %}>Good</option>
                                        <option value="Excellent" {% if lang.writing == 'Excellent' %}selected{% endif %}>Excellent</option>
                                        <option value="Native" {% if lang.writing == 'Native' %}selected{% endif %}>Native</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-700">Speaking</label>
                                    <select name="lang_speaking[{{ loop.index0 }}]" class="form-input-base text-sm">
                                        <option value="">Select</option>
                                        <option value="Basic" {% if lang.speaking == 'Basic' %}selected{% endif %}>Basic</option>
                                        <option value="Good" {% if lang.speaking == 'Good' %}selected{% endif %}>Good</option>
                                        <option value="Excellent" {% if lang.speaking == 'Excellent' %}selected{% endif %}>Excellent</option>
                                        <option value="Native" {% if lang.speaking == 'Native' %}selected{% endif %}>Native</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <button type="button" class="add-field-btn" onclick="addLanguage()">+ Add Language</button>
            </div>
        </fieldset>

        <!-- Skills Section -->
        <fieldset class="field-group">
            <legend class="text-lg font-semibold text-sky-700 mb-4">
                Skills
                <input type="checkbox" class="field-visibility-toggle" checked onchange="toggleSectionVisibility(this, 'skills-section')">
                <span class="text-xs text-slate-500">Show/Hide Section</span>
            </legend>
            <div id="skills-section">
                <label for="skills" class="block text-sm font-medium text-slate-700">Skills (comma-separated)</label>
                <textarea id="skills" name="skills" rows="3" 
                          class="form-textarea-base"
                          placeholder="e.g., JavaScript, Python, Project Management, Leadership">{{ data.skills or '' }}</textarea>
            </div>
        </fieldset>

        <!-- Custom Fields Section -->
        <fieldset class="field-group">
            <legend class="text-lg font-semibold text-sky-700 mb-4">Custom Fields</legend>
            <div id="custom-fields-container">
                <!-- Custom fields will be added here dynamically -->
            </div>
            <button type="button" class="add-field-btn" onclick="addCustomField()">+ Add Custom Field</button>
        </fieldset>

        <!-- Submit Button -->
        <div class="flex justify-center pt-6">
            <button type="submit" 
                    class="px-8 py-3 bg-sky-600 text-white font-semibold rounded-md shadow-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 transition ease-in-out duration-150">
                Save & Continue to Section Ordering →
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block body_end_scripts %}
<script>
let experienceCount = {{ data.experiences|length if data.experiences else 0 }};
let educationCount = {{ data.education_entries|length if data.education_entries else 0 }};
let achievementCount = {{ data.key_achievements|length if data.key_achievements else 0 }};
let languageCount = {{ data.languages|length if data.languages else 0 }};
let customFieldCount = 0;

function toggleFieldVisibility(checkbox, fieldId) {
    const field = document.getElementById(fieldId);
    if (checkbox.checked) {
        field.classList.remove('hidden-field');
        field.disabled = false;
    } else {
        field.classList.add('hidden-field');
        field.disabled = true;
    }
}

function toggleSectionVisibility(checkbox, sectionId) {
    const section = document.getElementById(sectionId);
    if (checkbox.checked) {
        section.style.display = 'block';
    } else {
        section.style.display = 'none';
    }
}

function toggleEndDate(checkbox) {
    const container = checkbox.closest('.field-group');
    const endDateInput = container.querySelector('input[type="month"][name*="end_date"]');
    if (checkbox.checked) {
        endDateInput.disabled = true;
        endDateInput.value = '';
    } else {
        endDateInput.disabled = false;
    }
}

function addExperience() {
    const container = document.getElementById('experience-container');
    const newExperience = document.createElement('div');
    newExperience.className = 'field-group removable experience-item';
    newExperience.setAttribute('data-index', experienceCount);
    
    newExperience.innerHTML = `
        <button type="button" class="remove-field-btn" onclick="removeExperience(this)">×</button>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-slate-700">Job Title *</label>
                <input type="text" name="exp_title[${experienceCount}]" class="form-input-base" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700">Company *</label>
                <input type="text" name="exp_company[${experienceCount}]" class="form-input-base" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700">Location</label>
                <input type="text" name="exp_location[${experienceCount}]" class="form-input-base">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700">Start Date</label>
                <input type="month" name="exp_start_date[${experienceCount}]" class="form-input-base">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700">End Date</label>
                <input type="month" name="exp_end_date[${experienceCount}]" class="form-input-base">
            </div>
            <div class="flex items-center">
                <input type="checkbox" name="exp_present[${experienceCount}]" class="form-checkbox-base" onchange="toggleEndDate(this)">
                <label class="ml-2 text-sm text-slate-700">Currently working here</label>
            </div>
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-slate-700">Description</label>
                <textarea name="exp_description[${experienceCount}]" rows="3" class="form-textarea-base" placeholder="Describe your responsibilities and achievements..."></textarea>
            </div>
        </div>
    `;
    
    container.appendChild(newExperience);
    experienceCount++;
}

function removeExperience(button) {
    button.closest('.experience-item').remove();
}

function addEducation() {
    const container = document.getElementById('education-container');
    const newEducation = document.createElement('div');
    newEducation.className = 'field-group removable education-item';
    newEducation.setAttribute('data-index', educationCount);
    
    newEducation.innerHTML = `
        <button type="button" class="remove-field-btn" onclick="removeEducation(this)">×</button>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-slate-700">Degree *</label>
                <input type="text" name="edu_degree[${educationCount}]" class="form-input-base" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700">Institution *</label>
                <input type="text" name="edu_institution[${educationCount}]" class="form-input-base" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700">Location</label>
                <input type="text" name="edu_location[${educationCount}]" class="form-input-base">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700">Start Date</label>
                <input type="month" name="edu_start_date[${educationCount}]" class="form-input-base">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700">End Date</label>
                <input type="month" name="edu_end_date[${educationCount}]" class="form-input-base">
            </div>
            <div class="flex items-center">
                <input type="checkbox" name="edu_present[${educationCount}]" class="form-checkbox-base" onchange="toggleEndDate(this)">
                <label class="ml-2 text-sm text-slate-700">Currently studying</label>
            </div>
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-slate-700">Details</label>
                <textarea name="edu_details[${educationCount}]" rows="2" class="form-textarea-base" placeholder="Additional details about your education..."></textarea>
            </div>
        </div>
    `;
    
    container.appendChild(newEducation);
    educationCount++;
}

function removeEducation(button) {
    button.closest('.education-item').remove();
}

function addAchievement() {
    const container = document.getElementById('achievements-container');
    const newAchievement = document.createElement('div');
    newAchievement.className = 'field-group removable achievement-item';
    newAchievement.setAttribute('data-index', achievementCount);
    
    newAchievement.innerHTML = `
        <button type="button" class="remove-field-btn" onclick="removeAchievement(this)">×</button>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-slate-700">Achievement Title *</label>
                <input type="text" name="ach_title_${achievementCount}" class="form-input-base" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700">Description</label>
                <textarea name="ach_description_${achievementCount}" rows="2" class="form-textarea-base" placeholder="Describe your achievement..."></textarea>
            </div>
        </div>
    `;
    
    container.appendChild(newAchievement);
    achievementCount++;
}

function removeAchievement(button) {
    button.closest('.achievement-item').remove();
}

function addLanguage() {
    const container = document.getElementById('languages-container');
    const newLanguage = document.createElement('div');
    newLanguage.className = 'field-group removable language-item';
    newLanguage.setAttribute('data-index', languageCount);
    
    newLanguage.innerHTML = `
        <button type="button" class="remove-field-btn" onclick="removeLanguage(this)">×</button>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-slate-700">Language *</label>
                <input type="text" name="lang_name[${languageCount}]" class="form-input-base" required placeholder="e.g., English, Spanish, French">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700">Overall Level</label>
                <select name="lang_level[${languageCount}]" class="form-input-base">
                    <option value="">Select level</option>
                    <option value="Beginner">Beginner</option>
                    <option value="Elementary">Elementary</option>
                    <option value="Intermediate">Intermediate</option>
                    <option value="Upper Intermediate">Upper Intermediate</option>
                    <option value="Advanced">Advanced</option>
                    <option value="Native">Native</option>
                </select>
            </div>
            <div class="proficiency-grid">
                <div>
                    <label class="block text-xs font-medium text-slate-700">Reading</label>
                    <select name="lang_reading[${languageCount}]" class="form-input-base text-sm">
                        <option value="">Select</option>
                        <option value="Basic">Basic</option>
                        <option value="Good">Good</option>
                        <option value="Excellent">Excellent</option>
                        <option value="Native">Native</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-700">Writing</label>
                    <select name="lang_writing[${languageCount}]" class="form-input-base text-sm">
                        <option value="">Select</option>
                        <option value="Basic">Basic</option>
                        <option value="Good">Good</option>
                        <option value="Excellent">Excellent</option>
                        <option value="Native">Native</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-700">Speaking</label>
                    <select name="lang_speaking[${languageCount}]" class="form-input-base text-sm">
                        <option value="">Select</option>
                        <option value="Basic">Basic</option>
                        <option value="Good">Good</option>
                        <option value="Excellent">Excellent</option>
                        <option value="Native">Native</option>
                    </select>
                </div>
            </div>
        </div>
    `;
    
    container.appendChild(newLanguage);
    languageCount++;
}

function removeLanguage(button) {
    button.closest('.language-item').remove();
}

function addCustomField() {
    const container = document.getElementById('custom-fields-container');
    const newField = document.createElement('div');
    newField.className = 'field-group removable custom-field-item';
    newField.setAttribute('data-index', customFieldCount);
    
    newField.innerHTML = `
        <button type="button" class="remove-field-btn" onclick="removeCustomField(this)">×</button>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-slate-700">Field Title *</label>
                <input type="text" name="custom_title_${customFieldCount}" class="form-input-base" required placeholder="e.g., Certifications, Awards, Projects">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700">Content</label>
                <textarea name="custom_content_${customFieldCount}" rows="3" class="form-textarea-base" placeholder="Enter the content for this field..."></textarea>
            </div>
        </div>
    `;
    
    container.appendChild(newField);
    customFieldCount++;
}

function removeCustomField(button) {
    button.closest('.custom-field-item').remove();
}

// Initialize form on page load
document.addEventListener('DOMContentLoaded', function() {
    // Set initial state for hidden fields
    const hiddenToggles = document.querySelectorAll('.field-visibility-toggle:not(:checked)');
    hiddenToggles.forEach(toggle => {
        const fieldId = toggle.closest('label').getAttribute('for');
        if (fieldId) {
            toggleFieldVisibility(toggle, fieldId);
        }
    });
});
</script>
{% endblock %}